<app-users></app-users>
<mat-tab-group animationDuration="500ms">
  <mat-tab label="Profile">
    <div class="h-full bg-gray-200 p-8">
      <div class="bg-white rounded-lg shadow-xl pb-8">
        <div class="w-full h-[70px]"></div>
        <div class="flex flex-col items-center -mt-20">
          <img
            *ngIf="userDetails.image"
            [src]="userDetails.image"
            class="w-40 border-4 border-white rounded-full"
            alt="Profile Picture"
          />
          <img
            *ngIf="!userDetails.image"
            src="https://static.vecteezy.com/system/resources/previews/011/483/813/original/guy-anime-avatar-free-vector.jpg"
            class="w-40 border-4 border-white rounded-full"
            alt="Profile Picture"
          />
          <p class="text-2xl">{{ userDetails.name }}</p>
          <div class="flex items-center space-x-2 mt-2">
            <label for="uploadImage" class="cursor-pointer">
              <span class="text-blue-500">Change Profile Picture</span>
              <input
                type="file"
                id="uploadImage"
                class="hidden"
                formControlName="img"
                (change)="changeProfile($event)"
              />
            </label>
          </div>
        </div>
      </div>
      <div
        class="my-4 flex flex-col 2xl:flex-row space-y-4 2xl:space-y-0 2xl:space-x-4"
      >
        <div class="w-full flex flex-col 2xl:w-1/3">
          <div class="flex-1 bg-white rounded-lg shadow-xl p-8">
            <h4 class="text-xl text-gray-900 font-bold">Personal Info</h4>
            <ul class="mt-2 text-gray-700">
              <li class="flex border-y py-2">
                <span class="font-bold w-24">Full name:</span>
                <span class="text-gray-700">{{ userDetails.name }}</span>
              </li>
              <li class="flex border-b py-2">
                <span class="font-bold w-24">Mobile:</span>
                <span class="text-gray-700">{{ userDetails.phone }}</span>
              </li>
              <li class="flex border-b py-2">
                <span class="font-bold w-24">Email:</span>
                <span class="text-gray-700">{{ userDetails.email }}</span>
              </li>
            </ul>
            <button
              mat-button
              (click)="openDialog()"
              class="mt-3 bg-gradient-to-r from-blue-500 to-blue-700 text-white px-6 py-3 rounded-full hover:from-blue-700 focus:outline-none focus:ring focus:border-blue-300"
            >
              <span class="flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 mr-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M2 15l7-7 7 7"
                  ></path>
                </svg>
                Edit Profile
              </span>
            </button>
          </div>
        </div>

        <div class="w-full flex flex-col 2xl:w-1/3">
          <div class="flex-1 bg-white rounded-lg shadow-xl p-8">
            <button
              mat-button
              class="text-blue-500"
              (click)="togglePasswordForm()"
            >
              {{ changePasswordToggle ? "Don't Change" : "Change" }} Password
            </button>
            <form *ngIf="changePasswordToggle" [formGroup]="changePasswordForm">
              <div class="flex flex-col space-y-2">
                <label for="currentPassword" class="font-bold"
                  >Current Password:</label
                >
                <input
                  type="password"
                  id="currentPassword"
                  class="p-2 border rounded"
                  formControlName="currentPassword"
                />
                <div
                  *ngIf="
                    changePasswordForm.get('currentPassword')?.invalid &&
                    (changePasswordForm.get('currentPassword')?.dirty ||
                      changePasswordForm.get('currentPassword')?.touched)
                  "
                  class="text-red-500 text-sm mt-1"
                >
                  <div
                    *ngIf="
                      changePasswordForm
                        .get('currentPassword')
                        ?.hasError('required')
                    "
                  >
                    Current Password is required.
                  </div>
                  <div
                    *ngIf="
                      changePasswordForm
                        .get('currentPassword')
                        ?.hasError('minlength')
                    "
                  >
                    Current Password must be at least 8 characters long.
                  </div>
                </div>
              </div>

              <div class="flex flex-col space-y-2">
                <label for="newPassword" class="font-bold">New Password:</label>
                <input
                  type="password"
                  id="newPassword"
                  class="p-2 border rounded"
                  formControlName="password"
                />
                <div
                  *ngIf="
                    changePasswordForm.get('password')?.invalid &&
                    (changePasswordForm.get('password')?.dirty ||
                      changePasswordForm.get('password')?.touched)
                  "
                  class="text-red-500 text-sm mt-1"
                >
                  <div
                    *ngIf="
                      changePasswordForm.get('password')?.hasError('required')
                    "
                  >
                    New Password is required.
                  </div>
                  <div
                    *ngIf="
                      changePasswordForm.get('password')?.hasError('minlength')
                    "
                  >
                    New Password must be at least 8 characters long.
                  </div>
                </div>
              </div>
              <div class="flex flex-col space-y-2">
                <label for="confirmPassword" class="font-bold"
                  >Confirm Password:</label
                >
                <input
                  type="password"
                  id="confirmPassword"
                  class="p-2 border rounded"
                  formControlName="confirmPassword"
                />
                <div
                  *ngIf="
                    changePasswordForm.get('confirmPassword')?.invalid &&
                    (changePasswordForm.get('confirmPassword')?.dirty ||
                      changePasswordForm.get('confirmPassword')?.touched)
                  "
                  class="text-red-500 text-sm mt-1"
                >
                  <div
                    *ngIf="
                      changePasswordForm
                        .get('confirmPassword')
                        ?.hasError('required')
                    "
                  >
                    Confirm Password is required.
                  </div>
                  <div
                    *ngIf="
                      changePasswordForm
                        .get('confirmPassword')
                        ?.hasError('minlength')
                    "
                  >
                    Confirm Password must be at least 8 characters long.
                  </div>
                  <div
                    *ngIf="
                      changePasswordForm
                        .get('confirmPassword')
                        ?.hasError('notMatching')
                    "
                  >
                    Passwords do not match.
                  </div>
                </div>
              </div>
              <button (click)="changePassword()"
                mat-button
                type="submit"
                class="mt-3 bg-gradient-to-r from-green-500 to-green-700 text-white px-6 py-3 rounded-full hover:from-green-700 focus:outline-none focus:ring focus:border-green-300"
                [disabled]="!changePasswordForm.valid"
              >
                <span class="flex items-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 mr-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    ></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M2 15l7-7 7 7"
                    ></path>
                  </svg>
                  Change Password
                </span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </mat-tab>

  <ng-template #callAPIDialog>
    <h2 mat-dialog-title class="text-3xl font-bold mb-4">Edit Profile</h2>
    <mat-dialog-content class="mat-typography">
      <div class="space-y-4">
        <form [formGroup]="editProfile" (ngSubmit)="saveChanges()">
          <div class="mb-4">
            <label for="editName" class="block text-lg font-semibold mb-1"
              >Name:</label
            >
            <input
              id="editName"
              type="text"
              formControlName="editName"
              name="editedName"
              class="form-input w-full border-b-2 focus:outline-none focus:border-blue-500"
              placeholder="Enter your full name"
            />
            <div
              *ngIf="
                editProfile.get('editName')?.hasError('required') &&
                editProfile.get('editName')?.touched
              "
              class="text-red-500"
            >
              Name is required.
            </div>
            <div
              *ngIf="
                editProfile.get('editName')?.hasError('hasWhiteSpace') &&
                editProfile.get('editName')?.touched
              "
              class="text-red-500"
            >
              Name cannot contain whitespace.
            </div>
          </div>
          <div class="mb-4">
            <label for="editPhone" class="block text-lg font-semibold mb-1"
              >Mobile:</label
            >
            <input
              id="editPhone"
              type="text"
              name="editedPhone"
              formControlName="editPhone"
              class="form-input w-full border-b-2 focus:outline-none focus:border-blue-500"
              placeholder="Enter your mobile number"
            />
            <div
              *ngIf="
                editProfile.get('editPhone')?.hasError('required') &&
                editProfile.get('editPhone')?.touched
              "
              class="text-red-500"
            >
              Mobile is required.
            </div>
            <div
              *ngIf="
                editProfile.get('editPhone')?.hasError('minlength') &&
                editProfile.get('editPhone')?.touched
              "
              class="text-red-500"
            >
              Mobile must be at least 10 digits.
            </div>
            <div
              *ngIf="
                editProfile.get('editPhone')?.hasError('maxlength') &&
                editProfile.get('editPhone')?.touched
              "
              class="text-red-500"
            >
              Mobile cannot be more than 10 digits.
            </div>
            <div
              *ngIf="
                editProfile.get('editPhone')?.hasError('pattern') &&
                editProfile.get('editPhone')?.touched
              "
              class="text-red-500"
            >
              Invalid mobile number format.
            </div>
            <div
              *ngIf="
                editProfile.get('editPhone')?.hasError('hasWhiteSpace') &&
                editProfile.get('editPhone')?.touched
              "
              class="text-red-500"
            >
              Mobile cannot contain whitespace.
            </div>
          </div>

          <div class="mb-4">
            <label for="editEmail" class="block text-lg font-semibold mb-1"
              >Email:</label
            >
            <input
              id="editEmail"
              type="email"
              name="editedEmail"
              class="form-input w-full bg-gray-100 p-2 rounded-md"
              placeholder="Enter your email"
              [value]="userDetails.email"
              readonly
            />
          </div>
        </form>
      </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button
        mat-button
        mat-dialog-close
        class="text-gray-600 hover:text-gray-800"
      >
        Cancel
      </button>
      <button
        (click)="saveChanges()"
        mat-button
        cdkFocusInitial
        class="bg-gradient-to-r from-blue-500 to-blue-700 text-white px-6 py-3 rounded-full hover:from-blue-700 focus:outline-none focus:ring focus:border-blue-300"
      >
        Save Changes
      </button>
    </mat-dialog-actions>
  </ng-template>
  <mat-tab label="Wallet">
    <div class="h-full bg-gray-200 p-8">
      <div class="flex flex-col items-center">
        <h2 class="text-2xl font-bold mb-4">My Wallet</h2>
        <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
          <p class="text-xl">
            Current Balance: {{ userDetails.wallet | currency : "INR" }}
          </p>
        </div>
        <div class="bg-white rounded-lg shadow-xl p-8">
          <h3 class="text-xl font-bold mb-4">Wallet History</h3>
          <div class="mb-4">
            <p>hi</p>
          </div>
        </div>
      </div>
    </div>
  </mat-tab>
  <app-footer></app-footer>
</mat-tab-group>
